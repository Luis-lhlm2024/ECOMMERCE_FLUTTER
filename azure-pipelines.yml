trigger:
  - main  # Se ejecuta cuando hay cambios en la rama main de GitHub

pool:
  vmImage: 'ubuntu-latest'  # Agente Ubuntu más reciente

steps:
  - checkout: none  # No se clona el repo de Azure DevOps directamente

  - script: |
      git config --global user.email "admin_devops@mintic.gov.co"
      git config --global user.name "admin_devops"

      # Clonar el repositorio desde GitHub
      git clone --bare https://github.com/Luis-lhlm2024/ECOMMERCE_FLUTTER.git repo_temp
      cd repo_temp

      # Agregar Azure DevOps como remoto
      git remote add azure https://$(AZURE_PAT)@dev.azure.com/MinisterioTIC/_git/App_ecommerce_flutter

      # Traer los últimos cambios de GitHub
      git fetch origin --prune  

      # Sincronizar todas las ramas con Azure DevOps
      git push --force --all azure
      git push --force --tags azure

    displayName: 'Sincronizar repositorio de Azure DevOps con GitHub'
    env:
      AZURE_PAT: $(AZURE_PAT)  # Token de autenticación en Azure DevOps
